<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>EnJoy by #impact</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
$(document).ready(function() {
  var banks = [];
  var locations = {};
  $.getJSON("cluster.php", function(d) {
        banks = d.banks;
        locations = d.locations;
        initialize();
    }).fail( function(d, textStatus, error) {
        console.error("getJSON failed, status: " + textStatus + ", error: "+error)
    });


var fail;


function initialize() {
  var mapOptions = {
    zoom: 14,
    center: new google.maps.LatLng(43.659905, -79.388648)
  }
  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  var active = [];
  var index, index2;
  for(index = 0; index < locations.routes.length; ++index){
    for(index2 = 0; index2 < locations.routes[index].length; ++index2)
    {
      active.push([locations.routes[index][index2].lat, locations.routes[index][index2].lng]);
    }
  }

  var inactive = [];
  for(index = 0; index < locations.inactive.length; ++index){
      inactive.push([locations.inactive[index].lat,locations.inactive[index].lng]);
  }

  var food = [];
  for(index = 0; index < banks.length; ++index){
    food.push([banks[index].lat,banks[index].lng]);
  }

  var lines = [];
  for(index = 0; index < banks.length; ++index){
    var temp = "start="+banks[index].addr;
    if(locations.routes[index].length > 0){
      temp+= "&way=";
      for(index2 = 0; index2 < locations.routes[index].length; ++index2){
        temp+= locations.routes[index][index2].addr+"|";
      }
      temp = temp.substring(0,temp.length-1);
    }
    temp = "directions.php?"+temp;
    $.get(temp, function(data){
      var tt = jQuery.parseJSON(data);
      var showmap = [];
      for(index2 = 0; index2 < tt.length; ++index2){
        showmap.push(new google.maps.LatLng(tt[index2][0],tt[index2][1]));
      }

      var tempcolors = ['red','orange','yellow','green','blue','black'];
      var flightPath = new google.maps.Polyline({
        path: showmap,
        geodesic: true,
        strokeColor: tempcolors[Math.floor((Math.random() * tempcolors.length) + 0)],
        strokeOpacity: 1.0,
        strokeWeight: 2
      });

      flightPath.setMap(fail);
    });
  }

  setMarkers(map, active, 'food.png');
  setMarkers(map, inactive, 'food2.png');
  setMarkers(map, food, 'bank.png');
  fail = map;
}

function setMarkers(map, locations, icon) {
  var image = {
    url: icon,
    size: new google.maps.Size(30, 30),// This marker is 20 pixels wide by 32 pixels tall.
    origin: new google.maps.Point(0,0),// The origin for this image is 0,0.
    anchor: new google.maps.Point(15,15)// The anchor for this image is the base of the flagpole at 0,32.
  };
  // Shapes define the clickable region of the icon.
  // The type defines an HTML &lt;area&gt; element 'poly' which
  // traces out a polygon as a series of X,Y points. The final
  // coordinate closes the poly by connecting to the first
  // coordinate.
  var shape = {
      coords: [1, 1, 1, 20, 18, 20, 18 , 1],
      type: 'poly'
  };
  for (var i = 0; i < locations.length; i++) {
    var beach = locations[i];
    var myLatLng = new google.maps.LatLng(beach[0], beach[1]);
    var marker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        icon: image,
        shape: shape
    });
  }
}


});

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>